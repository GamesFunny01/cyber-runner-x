<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Viewport stabil + no-zoom + aman notch -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no, interactive-widget=overlays-content"
    />
    <!-- No-cache keras di level dokumen -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#0B0B12" />
    <title>Cyber Runner X</title>

    <style>
      /* Bekukan tinggi viewport dan pindahkan scroll ke #root (bukan body) */
      :root { --app-vh: 100svh; }
      html, body { height: var(--app-vh); min-height: var(--app-vh); overflow: hidden; }
      #root { height: var(--app-vh); min-height: var(--app-vh); overflow: auto; -webkit-overflow-scrolling: touch; }
      * { -webkit-tap-highlight-color: transparent; }
      body { margin: 0; background: #0B0B12; overscroll-behavior: none; }
    </style>

    <script>
      // ===== 1) Bekukan tinggi viewport (hindari "auto-zoom" karena address bar) =====
      (function () {
        function freezeVH() {
          const vv = window.visualViewport;
          const h = vv ? Math.round(vv.height) : window.innerHeight;
          document.documentElement.style.setProperty('--app-vh', h + 'px');
        }
        freezeVH();
        window.addEventListener('orientationchange', () => setTimeout(freezeVH, 250), { passive: true });
        window.addEventListener('pageshow', () => setTimeout(freezeVH, 150), { passive: true });

        // Update saat visualViewport resize, tapi JANGAN biarkan event resize window liar
        if (window.visualViewport) {
          visualViewport.addEventListener('resize', () => setTimeout(freezeVH, 50), { passive: true });
        }
      })();

      // ===== 2) Saring resize event yang hanya berubah WIDTH yang kita ijinkan =====
      // (height-only resize dari toolbar/omnibox akan kita tahan supaya Game.jsx tidak re-layout tiba-tiba)
      (function () {
        let lastW = window.innerWidth || document.documentElement.clientWidth;
        window.addEventListener('resize', function (e) {
          const w = window.innerWidth || document.documentElement.clientWidth;
          if (Math.abs(w - lastW) < 2) {
            e.stopImmediatePropagation && e.stopImmediatePropagation();
            return;
          }
          lastW = w;
        }, true);
      })();

      // ===== 3) Cegah pinch & double-tap zoom =====
      (function () {
        const prevent = e => { e.preventDefault(); };
        document.addEventListener('gesturestart', prevent, { passive: false });
        document.addEventListener('wheel', e => { if (e.ctrlKey) e.preventDefault(); }, { passive: false });
        let lastTouch = 0;
        document.addEventListener('touchend', e => {
          const now = Date.now();
          if (now - lastTouch < 300) e.preventDefault();
          lastTouch = now;
        }, { passive: false });
      })();

      // ===== 4) iOS: auth â†’ full-page redirect (bypass popup blocker/ITP) =====
      (function () {
        const ua = navigator.userAgent || '';
        const isIOS = /iP(hone|od|ad)/.test(ua);
        if (!isIOS) return;
        const originalOpen = window.open;
        window.open = function (url) {
          try {
            if (typeof url === 'string' && /(privy|auth|login|connect|wallet)/i.test(url)) {
              location.href = url; return null;
            }
          } catch (_) {}
          return originalOpen ? originalOpen.apply(window, arguments) : null;
        };
      })();

      // ===== 5) Unregister service worker lama (hindari bundle ketahan cache) =====
      (function () {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(regs => {
            for (const r of regs) r.unregister();
          }).catch(() => {});
        }
      })();

      // (Opsional) Kalau mau override base API manual dari HTML (debug)
      // window.__API_BASE__ = "https://cyber-runner-x-production.up.railway.app";
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
